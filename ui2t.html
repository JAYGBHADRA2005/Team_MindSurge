<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calm AI - Mental Health Support</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(90deg, #f3f4f6, #e5e7eb);
            transition: background 0.3s, color 0.3s;
            margin: 0;
            padding: 0;
            animation: gradientAnimation 10s infinite alternate;
            overflow: hidden;
        }

        @keyframes gradientAnimation {
            0% { background: linear-gradient(120deg, #89CFF0, #ADD8E6, #87CEEB); }
            100% { background: linear-gradient(120deg, #87CEEB, #ADD8E6, #B0E0E6); }
        }

        .wave {
            position: absolute;
            width: 100%;
            height: 200px;
            bottom: 0;
            background: url('https://i.imgur.com/QkIa5Zc.png');
            background-size: cover;
            opacity: 0.5;
            animation: waveAnimation 6s infinite linear;
        }

        @keyframes waveAnimation {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }   
    
        .container {
            width: 100%;
            max-width: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0px 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: background 0.3s;
        }
        .dark-mode .container {
            background: #1e1e1e;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            font-size: 18px;
            font-weight: bold;
            background: linear-gradient(90deg, #60a5fa, #3b82f6);
            color: white;
        }
        .dark-mode .header {
            background: #2563eb;
        }
        .toggle-mode {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
        .chat-container {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .message {
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 75%;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease-in-out;
            margin-bottom: 10px;
        }
        .user-message {
            align-self: flex-end;
            background: #3b82f6;
            color: white;
        }
        .bot-message {
            align-self: flex-start;
            background: #e5e7eb;
            color: black;
        }
        .dark-mode .bot-message {
            background: #333;
            color: white;
        }
        .chat-input {
            display: flex;
            padding: 12px;
            background: #f9fafb;
            border-top: 2px solid #3b82f6;
        }
        .dark-mode .chat-input {
            background: #2d2d2d;
            border-top: 1px solid #444;
        }
        .chat-input input {
            flex-grow: 1;
            padding: 12px;
            border-radius: 20px;
            border: 1px solid #3b82f6;
            outline: none;
            font-size: 14px;
        }
        .dark-mode .chat-input input {
            background: #1e1e1e;
            color: white;
            border: 1px solid #444;
        }
        .chat-input button {
            margin-left: 10px;
            padding: 12px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: background 0.3s;
        }
        .chat-input button:hover {
            background: #2563eb;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    }
</style>
</head>
<body>
    
    <div class="container">
        <div class="header">
            <h3>Your mental health support companion.</h3>
            <button class="toggle-mode" onclick="toggleDarkMode()">üåô</button>
        </div>
        <div class="chat-container" id="chatBox"></div>
        <div class="chat-input">
            <button class="voice-btn" onclick="startSpeechRecognition()">üéôÔ∏è</button>
            <input type="text" id="userInput" placeholder="üí¨ Share your thoughts..." onkeydown="handleKeyPress(event)">
            <button class="chat-input-button" onclick="sendMessage()">Send</button>
            <button class="chat-input-button" onclick="clearChatHistory()">Clear Chats</button>
        </div>
    </div>
    <script>
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
        }

        function displayMessage(message, sender) {
            let chatBox = document.getElementById("chatBox");
            let messageDiv = document.createElement("div");
            messageDiv.classList.add("message", sender === "user" ? "user-message" : "bot-message");
            messageDiv.textContent = message;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        function sendMessage() {
            let userInput = document.getElementById("userInput");
            let chatBox = document.getElementById("chatBox");
            let messageText = userInput.value.trim();
            if (messageText === "") return;

            displayMessage(messageText, "user");
            userInput.value = "";

            const history = JSON.parse(localStorage.getItem("chatHistory")) || [];
            history.push({ sender: "user", text: messageText });
            localStorage.setItem("chatHistory", JSON.stringify(history));

            setTimeout(() => {
                let botMessageText = getCalmResponse(messageText);
                console.log("Bot response:", botMessageText); // Log the bot's response
                displayMessage(botMessageText, "ai");
                history.push({ sender: "ai", text: botMessageText });
                localStorage.setItem("chatHistory", JSON.stringify(history));
            }, 1000);
        }

        function handleKeyPress(event) {
            if (event.key === "Enter") {
                sendMessage();
            }
        }

        function startSpeechRecognition() {
            if (!('SpeechRecognition' in window || 'webkitSpeechRecognition' in window)) {
                alert("Sorry, your browser does not support speech recognition.");
                return;
            }

            let recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.continuous = false; // Disable continuous recognition

            recognition.lang = 'en-US';
            recognition.start();

            let userInput = document.getElementById("userInput");
            userInput.value = ""; // Clear input after recognition

            userInput.placeholder = "üé§ Listening...";
            recognition.onresult = function(event) {
                let transcript = event.results[0][0].transcript;
                userInput.value = transcript;
                sendMessage();
            };
            recognition.onend = function() {
                userInput.placeholder = "How are you feeling today?";
                // Do not restart recognition automatically
            };

            recognition.onerror = function(event) {
                console.error("Speech recognition error", event.error);
                alert("An error occurred during speech recognition: " + event.error + ". Please check your microphone permissions.");

                userInput.placeholder = "How are you feeling today?";
            };
        }

        function loadChatHistory() {
            const chatBox = document.getElementById("chatBox");
            chatBox.innerHTML = "";
            const history = JSON.parse(localStorage.getItem("chatHistory")) || [];
            history.forEach(msg => {
                displayMessage(msg.text, msg.sender);
            });
        }

        function clearChatHistory() {
            const history = JSON.parse(localStorage.getItem("chatHistory")) || [];
            const chatSessions = JSON.parse(localStorage.getItem("chatSessions")) || [];
            
            // Save current chat history to chat sessions
            chatSessions.push({ id: new Date().toISOString(), history: history });
            localStorage.setItem("chatSessions", JSON.stringify(chatSessions));
            
            // Clear the chat history
            localStorage.removeItem("chatHistory");
            loadChatHistory();
        }

        function speak(text, voiceType) {
            console.log("Speaking text:", text); // Log the text being spoken
            let speech = new SpeechSynthesisUtterance(text);
            speech.lang = 'en-US';
            
            // Retrieve available voices
            const voices = window.speechSynthesis.getVoices();
            console.log("Available voices:", voices); // Log available voices
            
            // Set the voice based on the voiceType parameter
            if (voiceType === 'male') {
                speech.voice = voices.find(voice => voice.name.toLowerCase().includes('male'));
            } else if (voiceType === 'female') {
                speech.voice = voices.find(voice => voice.name.toLowerCase().includes('female'));
            }
            
            window.speechSynthesis.speak(speech);
        }

        window.onload = loadChatHistory;

        function getCalmResponse(input, voiceType = 'female') {
            let responses = [
                "I'm here for you. Take a deep breath and tell me what's on your mind.",
                "You're not alone. I'm here to support you through this.",
                "It's okay to have difficult days. You are not alone.",
                "You're doing your best, and that's enough. How can I support you today?",
                "Sometimes, a small step forward is all you need. What‚Äôs something positive you can do for yourself today?",
                "Remember, it's okay to ask for help when you need it."
            ];
            const response = responses[Math.floor(Math.random() * responses.length)];
            speak(response, voiceType); // Speak the response
            return response;
        }
    </script>
</body>
</html>
